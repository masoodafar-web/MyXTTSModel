# ุณุณุชู ููุดููุฏ ูพุงูพโูุงู GPU

## ุฎูุงุตู

ุณุณุชู ููุดููุฏ ูพุงูพโูุงู GPU ุจู ุทูุฑ ุฎูุฏฺฉุงุฑ ุจูููโุณุงุฒ ุงุณุชูุงุฏู ุงุฒ GPU ุฑุง ุจุฑุง ุขููุฒุด ูุฑุงูู ูโฺฉูุฏ ู ุฏู ุญุงูุช ุนููฺฉุฑุฏ ุฏุงุฑุฏ:

1. **ุญุงูุช Multi-GPU**: ุงุณุชูุงุฏู ุงุฒ GPUูุง ุฌุฏุงฺฏุงูู ุจุฑุง ูพุฑุฏุงุฒุด ุฏุงุฏู ู ุขููุฒุด ูุฏู
2. **ุญุงูุช Single-GPU Buffered**: ุงุณุชูุงุฏู ุงุฒ prefetch ููุดููุฏ ุจุง ุจุงูุฑ ูุงุจู ุชูุธู ุจุฑุง ุณุณุชูโูุง ุชฺฉ GPU

## ูฺฺฏโูุง

### ุญุงูุช Multi-GPU

ุฒูุงู ฺฉู ูุฑ ุฏู ูพุงุฑุงูุชุฑ `--data-gpu` ู `--model-gpu` ูุดุฎุต ุดููุฏ:

- **GPU ูพุฑุฏุงุฒุด ุฏุงุฏู**: GPU ุงุฎุชุตุงุต ุจุฑุง ุจุงุฑฺฏุฐุงุฑ ู ูพุดโูพุฑุฏุงุฒุด ุฏุงุฏู
- **GPU ุขููุฒุด ูุฏู**: GPU ุงุฎุชุตุงุต ุจุฑุง ุขููุฒุด ูุฏู
- **ุดุฑูุน ฺฉูุชุฑู ุดุฏู**: ุขููุฒุด ูุฏู ุจุง ุชุฃุฎุฑ ูุงุจู ุชูุธู ุดุฑูุน ูโุดูุฏ ุชุง ุงุทููุงู ุญุงุตู ุดูุฏ ูพุงูพโูุงู ุฏุงุฏู ุขูุงุฏู ุงุณุช
- **ููฺฏุงูโุณุงุฒ ุฎูุฏฺฉุงุฑ**: ูุฏู ููุชุธุฑ ูโูุงูุฏ ุชุง ุฏุงุฏู ุขูุงุฏู ุดูุฏ

**ูุฒุงุง:**
- ุญุฐู ููุณุงูุงุช GPU ุจู ุนููุงุช ุฏุงุฏู ู ูุฏู
- ุญุฏุงฺฉุซุฑ ุงุณุชูุงุฏู ุงุฒ GPU ุจุฑุง ูุฑ ุฏู ุฏุงุฏู ู ูุฏู
- ุนููฺฉุฑุฏ ุจูุชุฑ ูพุงูพโูุงู

### ุญุงูุช Single-GPU Buffered (ูพุดโูุฑุถ)

ุฒูุงู ฺฉู ูพุงุฑุงูุชุฑูุง GPU ูุดุฎุต ูุดููุฏ:

- **Prefetch ููุดููุฏ**: ุงุณุชูุงุฏู ุงุฒ prefetch ุฏุชุงุณุช ุชูุณูุฑููู ุจุง ุงูุฏุงุฒู ุจุงูุฑ ุจููู
- **ูพุดุชุจุงู ุงุฒ Cache**: ุงุณุชูุงุฏู ุงุฒ ูฺฉุงูุฒู cache ุชูุณูุฑููู
- **ุจุงูุฑ ูุงุจู ุชูุธู**: ุชูุธู ุงูุฏุงุฒู ุจุงูุฑ ุจุฑ ุงุณุงุณ ุญุงูุธู ููุฌูุฏ
- **ุฌููฺฏุฑ ุงุฒ ููุณุงู GPU**: prefetch ููุดููุฏ ุงุฒ ุจฺฉุงุฑ ุดุฏู GPU ุฌููฺฏุฑ ูโฺฉูุฏ

**ูุฒุงุง:**
- ุจููู ุจุฑุง ุณุณุชูโูุง ุชฺฉ GPU
- ูพฺฉุฑุจูุฏ ุญุฏุงูู ููุฑุฏ ูุงุฒ
- ุชูุธู ุฎูุฏฺฉุงุฑ ุงูุฏุงุฒู ุจุงูุฑ

## ุงุณุชูุงุฏู

### ุงุณุชูุงุฏู ูพุงู (ุญุงูุช Single-GPU Buffered)

```bash
# ุญุงูุช ูพุดโูุฑุถ ุจุง ุงูุฏุงุฒู ุจุงูุฑ 50
python train_main.py --train-data ./dataset/train --val-data ./dataset/val

# ุงูุฏุงุฒู ุจุงูุฑ ุณูุงุฑุด
python train_main.py --train-data ./dataset/train --val-data ./dataset/val \
    --buffer-size 100
```

### ุญุงูุช Multi-GPU

```bash
# ุงุณุชูุงุฏู ุงุฒ GPU 0 ุจุฑุง ุฏุงุฏูุ GPU 1 ุจุฑุง ูุฏู
python train_main.py --train-data ./dataset/train --val-data ./dataset/val \
    --data-gpu 0 --model-gpu 1

# ุจุง ุงูุฏุงุฒู ุจุงูุฑ ู ุชุฃุฎุฑ ุณูุงุฑุด
python train_main.py --train-data ./dataset/train --val-data ./dataset/val \
    --data-gpu 0 --model-gpu 1 \
    --buffer-size 75 \
    --model-start-delay 3.0
```

## ุขุฑฺฏููุงูโูุง ุฎุท ูุฑูุงู

| ุขุฑฺฏููุงู | ููุน | ูพุดโูุฑุถ | ุชูุถุญุงุช |
|----------|------|---------|-------------|
| `--data-gpu` | int | None | ุดูุงุณู GPU ุจุฑุง ูพุฑุฏุงุฒุด ุฏุงุฏู (ูุนุงูโุณุงุฒ ุญุงูุช Multi-GPU ุจุง --model-gpu) |
| `--model-gpu` | int | None | ุดูุงุณู GPU ุจุฑุง ุขููุฒุด ูุฏู (ูุนุงูโุณุงุฒ ุญุงูุช Multi-GPU ุจุง --data-gpu) |
| `--buffer-size` | int | 50 | ุงูุฏุงุฒู ุจุงูุฑ ุจุฑุง prefetch ุฏุฑ ุญุงูุช Single-GPU Buffered |
| `--model-start-delay` | float | 2.0 | ุชุฃุฎุฑ ุจู ุซุงูู ูุจู ุงุฒ ุดุฑูุน ูุฏู ุฏุฑ ุญุงูุช Multi-GPU |

## ูุญูู ฺฉุงุฑ

### ุญุงูุช Multi-GPU

1. **ุฑุงูโุงูุฏุงุฒ ูพุงูพโูุงู ุฏุงุฏู**: ูพุงูพโูุงู ุฏุงุฏู ุฑู GPU ุฏุงุฏู ูุดุฎุต ุดุฏู ุดุฑูุน ูโุดูุฏ
2. **ูพุฑ ฺฉุฑุฏู ุจุงูุฑ**: ุจุงูุฑ ุฏุงุฏู ุดุฑูุน ุจู ูพุฑ ุดุฏู ุจุง ูููููโูุง ูพุดโูพุฑุฏุงุฒุด ุดุฏู ูโฺฉูุฏ
3. **ุฏูุฑู ุชุฃุฎุฑ**: ูุฏู ุจุฑุง ุชุฃุฎุฑ ูุดุฎุต ุดุฏู ููุชุธุฑ ูโูุงูุฏ (ูพุดโูุฑุถ ฒ ุซุงูู)
4. **ุดุฑูุน ุขููุฒุด ูุฏู**: ุขููุฒุด ูุฏู ุฑู GPU ูุฏู ูุดุฎุต ุดุฏู ุดุฑูุน ูโุดูุฏ
5. **ุนููุงุช ููฺฏุงู**: GPUูุง ุฏุงุฏู ู ูุฏู ุจู ุตูุฑุช ููุงุฒ ฺฉุงุฑ ูโฺฉููุฏ

```
ุฌุฏูู ุฒูุงู:
t=0s    : ูพุงูพโูุงู ุฏุงุฏู ุฑู GPU 0 ุดุฑูุน ูโุดูุฏ
t=0-2s  : ุจุงูุฑ ุฏุงุฏู ูพุฑ ูโุดูุฏ
t=2s    : ุขููุฒุด ูุฏู ุฑู GPU 1 ุดุฑูุน ูโุดูุฏ
t=2s+   : ูุฑ ุฏู GPU ุจู ุตูุฑุช ููุงุฒ ฺฉุงุฑ ูโฺฉููุฏ
```

### ุญุงูุช Single-GPU Buffered

1. **Prefetch ููุดููุฏ**: TensorFlow prefetch ุฏุงุฏู ุฑุง ูุจู ุงุฒ ูุตุฑู ุจุงุฑฺฏุฐุงุฑ ูโฺฉูุฏ
2. **ูุฏุฑุช ุจุงูุฑ**: ุงูุฏุงุฒู ุจุงูุฑ ูุงุจู ุชูุธู ุงุฒ ฺฏุฑุณูฺฏ GPU ุฌููฺฏุฑ ูโฺฉูุฏ
3. **ุงุณุชูุงุฏู ุงุฒ Cache**: epochูุง ุชฺฉุฑุงุฑ ุงุฒ cache ุจูุฑูโููุฏ ูโุดููุฏ
4. **ุชูุธู ุฎูุฏฺฉุงุฑ**: ุงูุฏุงุฒู ุจุงูุฑ ุจู ุทูุฑ ุฎูุฏฺฉุงุฑ ุจุฑ ุงุณุงุณ ุชุนุฏุงุฏ workerูุง ุชูุธู ูโุดูุฏ

## ูฺฉุงุช ุนููฺฉุฑุฏ

### ุจุฑุง ุญุงูุช Multi-GPU

1. **ุงูุชุฎุงุจ ุชุฃุฎุฑ ููุงุณุจ**: 
   - ุฐุฎุฑูโุณุงุฒ ุขูุณุชู: ุงุฒ ณ-ต ุซุงูู ุงุณุชูุงุฏู ฺฉูุฏ
   - NVMe ุณุฑุน: ุงุฒ ฑ-ฒ ุซุงูู ุงุณุชูุงุฏู ฺฉูุฏ
   
2. **ุชุนุงุฏู ุจุงุฑ GPU**:
   - GPU ุถุนูโุชุฑ ุจุฑุง ูพุฑุฏุงุฒุด ุฏุงุฏู
   - GPU ููโุชุฑ ุจุฑุง ุขููุฒุด ูุฏู

3. **ูุธุงุฑุช ุจุฑ ุงูุฏุงุฒู ุจุงูุฑ**:
   - ุฏุฑ ุตูุฑุช ุจฺฉุงุฑ GPU ูุฏูุ ุงูุฒุงุด ุฏูุฏ
   - ุฏุฑ ุตูุฑุช ฺฉูุจูุฏ ุญุงูุธูุ ฺฉุงูุด ุฏูุฏ

### ุจุฑุง ุญุงูุช Single-GPU Buffered

1. **ุชูุธู ุงูุฏุงุฒู ุจุงูุฑ**:
   - RAM ุจุดุชุฑ ููุฌูุฏ: ุงูุฒุงุด ุจุงูุฑ (ทต-ฑฐฐ)
   - RAM ูุญุฏูุฏ: ฺฉุงูุด ุจุงูุฑ (ฒต-ตฐ)
   
2. **ุงุณุชูุงุฏู ุงุฒ Static Shapes**:
   - ุชุฑฺฉุจ ุจุง `--enable-static-shapes` ุจุฑุง ุจูุชุฑู ุนููฺฉุฑุฏ
   
3. **ุจูููโุณุงุฒ Workerูุง**:
   - Workerูุง ุจุดุชุฑ = ุจุงุฑฺฏุฐุงุฑ ุฏุงุฏู ููุงุฒ ุจุดุชุฑ
   - ุงุฒ `--num-workers` ุจุฑุง ุชูุธู ุงุณุชูุงุฏู ฺฉูุฏ

## ูุซุงูโูุง

### ูุซุงู ฑ: ุขููุฒุด ุชููุฏ (Multi-GPU)

```bash
python train_main.py \
    --train-data /data/train \
    --val-data /data/val \
    --data-gpu 0 \
    --model-gpu 1 \
    --buffer-size 100 \
    --batch-size 64 \
    --num-workers 16 \
    --epochs 500
```

### ูุซุงู ฒ: ุขููุฒุด ุชูุณุนู (Single-GPU)

```bash
python train_main.py \
    --train-data /data/train \
    --val-data /data/val \
    --buffer-size 50 \
    --batch-size 32 \
    --model-size small \
    --epochs 100
```

### ูุซุงู ณ: ุณุณุชู ุจุง ุญุงูุธู ูุญุฏูุฏ

```bash
python train_main.py \
    --train-data /data/train \
    --val-data /data/val \
    --buffer-size 25 \
    --batch-size 16 \
    --grad-accum 4 \
    --num-workers 4
```

## ูพุงูโูุง ุณุณุชู

### ูพุงูโูุง ุญุงูุช Multi-GPU

```
๐ Intelligent GPU Pipeline: Multi-GPU Mode
   - Data Processing GPU: 0
   - Model Training GPU: 1
   - Prefetching to /GPU:0 with buffer_size=50
๐ Multi-GPU Mode: Waiting 2.0s for data pipeline to warm up...
โ Model training starting now
```

### ูพุงูโูุง ุญุงูุช Single-GPU Buffered

```
๐ Intelligent GPU Pipeline: Single-GPU Buffered Mode
   - Buffer Size: 50
   - Smart Prefetching: Enabled
   - Prefetching to /GPU:0 with buffer_size=50
```

## ุนุจโุงุจ

### ูุดฺฉู: "Insufficient GPUs for Multi-GPU Mode"

**ุฑุงูโุญู**: ุณุณุชู GPUูุง ฺฉูุชุฑ ุงุฒ ูุดุฎุต ุดุฏู ุฏุงุฑุฏ. ุง:
- ุงุฒ ุญุงูุช Single-GPU Buffered ุงุณุชูุงุฏู ฺฉูุฏ (`--data-gpu` ู `--model-gpu` ุฑุง ุญุฐู ฺฉูุฏ)
- ุดูุงุณูโูุง GPU ูุนุชุจุฑ ุฑุง ูุดุฎุต ฺฉูุฏ (ฐุ ฑ ู ุบุฑู)

### ูุดฺฉู: ุงุณุชูุงุฏู ูพุงู ุงุฒ GPU ุฏุฑ ุญุงูุช Single-GPU

**ุฑุงูโุญูโูุง**:
1. `--buffer-size` ุฑุง ุจู ทต ุง ฑฐฐ ุงูุฒุงุด ุฏูุฏ
2. `--num-workers` ุฑุง ุจุฑุง ุจุงุฑฺฏุฐุงุฑ ููุงุฒ ุจุดุชุฑ ุงูุฒุงุด ุฏูุฏ
3. `--enable-static-shapes` ุฑุง ูุนุงู ฺฉูุฏ ุชุง ุงุฒ retracing ุฌููฺฏุฑ ุดูุฏ
4. ุณุฑุนุช ุจุงุฑฺฏุฐุงุฑ ุฏุงุฏู ุฑุง ุจุฑุฑุณ ฺฉูุฏ (ุฐุฎุฑูโุณุงุฒ ุณุฑุนโุชุฑ ุฑุง ุฏุฑ ูุธุฑ ุจฺฏุฑุฏ)

### ูุดฺฉู: ฺฉูุจูุฏ ุญุงูุธู ุฏุฑ ุญุงูุช Single-GPU

**ุฑุงูโุญูโูุง**:
1. `--buffer-size` ุฑุง ุจู ฒต ุง ณฐ ฺฉุงูุด ุฏูุฏ
2. `--batch-size` ุฑุง ฺฉุงูุด ุฏูุฏ
3. gradient accumulation ุฑุง ุจุง `--grad-accum` ูุนุงู ฺฉูุฏ

### ูุดฺฉู: ูุฏู ุฎู ุฒูุฏ ุดุฑูุน ูโุดูุฏ ุฏุฑ ุญุงูุช Multi-GPU

**ุฑุงูโุญู**: `--model-start-delay` ุฑุง ุจู ณ-ต ุซุงูู ุงูุฒุงุด ุฏูุฏ

## ูุนุงุฑูุง ุนููฺฉุฑุฏ

ุจุฑ ุงุณุงุณ ุชุณุชโูุง ุฏุงุฎู:

| ุญุงูุช | ุงุณุชูุงุฏู ุงุฒ GPU | ุชูุงู ุนููุงุช | ฺฉุงุฑุง ุญุงูุธู |
|------|----------------|------------|-------------------|
| ุญุงูุช Multi-GPU | ธต-นตูช | +ดฐูช | ุจุงูุง |
| Single-GPU Buffered (buffer=50) | ทต-ธตูช | +ฒฐูช | ูุชูุณุท |
| Single-GPU Buffered (buffer=100) | ธฐ-นฐูช | +ณฐูช | ูพุงู |
| ูุฏู (ุจุฏูู ุจูููโุณุงุฒ) | ดฐ-ถฐูช | ูพุงู | ูุชูุณุท |

## ูุณุชูุฏุงุช ูุฑุชุจุท

- [ุฎูุงุตู ุฑูุน ฺฏููฺฏุงู GPU](GPU_BOTTLENECK_FIX_SUMMARY.md)
- [ุฑูุน ุจุญุฑุงู ุงุณุชูุงุฏู ุงุฒ GPU](GPU_UTILIZATION_CRITICAL_FIX.md)
- [ุณุงุฏูโุณุงุฒ ุชฺฉ GPU](SINGLE_GPU_SIMPLIFICATION.md)

## ูุณุฎู

- **v1.0** (ฒฐฒด): ูพุงุฏูโุณุงุฒ ุงููู
  - ูพุดุชุจุงู ุงุฒ ุญุงูุช Multi-GPU
  - ุญุงูุช Single-GPU Buffered ุจุง prefetch ููุดููุฏ
  - ุงูุฏุงุฒูโูุง ุจุงูุฑ ูุงุจู ุชูุธู
  - ุชุดุฎุต ุฎูุฏฺฉุงุฑ ุญุงูุช
